<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NFCKING – Kontaktløse visittkort | Demo & forhåndsvisning</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css">
  <style>
    :root{
      --brand:#3fffd2;
      --ink:#0b0b10;
      --card:#12121a;
      --muted:#8ea0b4;
    }
    body{background:var(--ink);color:#eaf2ff}
    .hero{display:grid;gap:18px;align-items:center;grid-template-columns:1.2fr 1fr;margin-top:10px}
    @media (max-width:900px){.hero{grid-template-columns:1fr}}
    .tag{display:inline-block;padding:.25rem .6rem;border-radius:999px;background:#17333a;color:#9ef7ea;font-weight:700}
    .pill{display:inline-block;padding:.15rem .5rem;border-radius:999px;background:#243244;color:#cfe3ff;margin-right:.3rem;font-size:.8rem;border:1px solid #344458}
    .muted{color:var(--muted)}
    .grid{display:grid;gap:14px}
    .col-2{grid-template-columns:1fr 1fr}
    .card{background:var(--card);border-radius:14px;padding:16px}
    .inline{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .logo-prev{height:42px;max-width:240px;object-fit:contain;background:#fff;border-radius:8px;padding:6px}
    .preview-wrap{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    @media (max-width:980px){.preview-wrap{grid-template-columns:1fr}}
    .phone{background:#0f1216;border:1px solid #1d2430;border-radius:28px;padding:18px}
    .phone iframe{width:100%;height:520px;border:0;border-radius:10px;background:#0b0b10}
    .mock{background:#0f1216;border:1px solid #1d2430;border-radius:14px;padding:16px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:720px){.row{grid-template-columns:1fr}}
    .btn{display:inline-block;padding:12px 14px;border-radius:10px;text-decoration:none;font-weight:700;background:#8fd3ff;color:#03101a;border:0;cursor:pointer}
    .help{font-size:.9rem;color:#9fb0c6}
    .brandmark{filter:drop-shadow(0 0 6px var(--brand))}
    code{background:#0d1117;color:#d1e7ff;padding:.2em .4em;border-radius:6px}
    canvas.card-canvas{width:100%;height:auto;max-width:100%;border-radius:14px;display:block;background:#111}
  </style>
</head>
<body>

<header class="card" style="display:flex;justify-content:space-between;align-items:center;gap:12px">
  <div class="inline">
    <img src="/assets/NFCKING_dark.png" alt="NFCKING" class="brandmark" style="height:40px">
    <span class="tag">Kontaktløse visittkort</span>
  </div>
  <div class="inline">
    <a href="#demo" class="btn">Prøv demo</a>
    <a href="#hvordan" class="pill">Hvordan funker det?</a>
  </div>
</header>

<section class="hero">
  <div>
    <h1>NFCKING – én lenke, ett kort, uendelig fleksibelt.</h1>
    <p class="muted">Lag og del digitale visittkort med NFC/QR. Bedrifter kan administrere ansatte, logoer, farger og lenker på sekunder – alt vises live.</p>
    <ul>
      <li>✅ Forhåndsvisning av <b>digitalt kort</b> (live)</li>
      <li>✅ Matchende <b>fysisk kort-mockup</b> (red / light / dark)</li>
      <li>✅ Uendelig mange lenker med tekst over/under</li>
      <li>✅ Klar for NFC/QR og GitHub Pages publisering</li>
    </ul>

    <div class="inline" style="margin-top:8px">
      <label>Stil (mockup): 
        <select id="cardStyle">
          <option value="dark" selected>Dark</option>
          <option value="light">Light</option>
          <option value="red">Red</option>
        </select>
      </label>
      <button type="button" id="downloadHeroMock" class="pill">Last ned mockup (PNG)</button>
    </div>
  </div>

  <!-- Felles mockup-canvas (øverst) -->
  <div class="card">
    <canvas id="heroMock" class="card-canvas" width="1000" height="630"></canvas>
    <p class="help">Mockupen over bruker samme renderer som i demoen under – de vil alltid være identiske.</p>
  </div>
</section>

<section id="hvordan" class="card">
  <h2>Hvordan funker det?</h2>
  <div class="grid col-2">
    <div>
      <h3>1) Fyll inn profil</h3>
      <p class="muted">Velg organisasjon, legg inn navn, tittel, telefon, e-post og evt. adresse. Lim inn logo-URL (eller last opp via admin).</p>
    </div>
    <div>
      <h3>2) Se live forhåndsvisning</h3>
      <p class="muted">Det digitale kortet og den fysiske mockupen rendres av samme kode – dermed ser de helt like ut.</p>
    </div>
    <div>
      <h3>3) Publiser</h3>
      <p class="muted">Når du er fornøyd, publiserer du fra admin (egen side) til GitHub Pages. NFC/QR kan brukes med én gang.</p>
    </div>
    <div>
      <h3>4) Skaler</h3>
      <p class="muted">Administrer alle ansatte, importer fra kontakter, og bestill fysiske kort fra samme grensesnitt.</p>
    </div>
  </div>
</section>

<section id="demo" class="card">
  <h2>Prøv demoen – fyll ut og se live</h2>

  <!-- Skjema -->
  <div class="row">
    <label>Organisasjon (visningsnavn)
      <input id="orgName" placeholder="Wayback Trondheim">
    </label>
    <label>Org key (mappe/URL, case sensitive)
      <input id="orgKey" placeholder="Wayback" value="Wayback">
    </label>
    <label>Accent-farge (hex)
      <input id="accent" placeholder="#8fd3ff" value="#8fd3ff">
    </label>
   <label>Logo URL
  <input id="logoUrl" placeholder="https://…/logo.png" oninput="previewLogo()">
</label>

<label>…eller last opp logo (PNG/JPG/SVG)
  <input id="logoFile" type="file" accept="image/*" />
  <small class="help" id="logoFileNote" style="display:block;margin-top:4px"></small>
</label>

<label>Logo bakgrunn (valgfri)
  <input id="logoBg" placeholder="#ffffff (tom = auto)">
</label>
<div class="inline">
  <img id="logoPreview" class="logo-prev" alt="logo" style="display:none">
  <span class="help">Tips: hvis logo har mørk bakgrunn, sett <code>#ffffff</code> her.</span>
</div>
  </div>

  <hr>

  <div class="row">
    <label>Navn
      <input id="name" placeholder="Trygve Eiulf Waagen" value="">
    </label>
    <label>Tittel
      <input id="title" placeholder="Avdelingsleder">
    </label>
    <label>Telefon
      <input id="phone" placeholder="+47 47731087">
    </label>
    <label>E-post
      <input id="email" placeholder="trygve@wayback.no">
    </label>
    <label>Nettside
      <input id="site" placeholder="https://wayback.no">
    </label>
    <label>Adresse
      <input id="address" placeholder="Kongens gate 46, 7012 Trondheim">
    </label>
    <label>Slug (mappe/URL)
      <input id="slug" placeholder="Trygve">
    </label>
    <label>VCF-filnavn
      <input id="vcfFilename" placeholder="trygve_wayback.vcf">
    </label>
  </div>

  <h3>Lenker</h3>
  <div class="row">
    <label>Forvalg (klikk for å legge til)</label>
    <div>
      <button type="button" class="pill" data-label="LinkedIn" data-url="https://www.linkedin.com/in/">LinkedIn</button>
      <button type="button" class="pill" data-label="Instagram" data-url="https://instagram.com/">Instagram</button>
      <button type="button" class="pill" data-label="Facebook"  data-url="https://facebook.com/">Facebook</button>
      <button type="button" class="pill" data-label="YouTube"   data-url="https://youtube.com/@">YouTube</button>
      <button type="button" class="pill" data-label="Nettside"  data-url="https://">Nettside</button>
    </div>
  </div>

  <table id="linksTable" style="width:100%;border-collapse:collapse">
    <thead>
      <tr>
        <th>Label</th><th>URL</th><th>Tekst over</th><th>Tekst under</th><th></th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="row">
    <label>Ny label <input id="newLabel" placeholder="LinkedIn"></label>
    <label>Ny URL   <input id="newUrl" placeholder="https://linkedin.com/in/..."></label>
    <label>Tekst over <input id="newPre" placeholder="Følg meg på LinkedIn"></label>
    <label>Tekst under<input id="newPost" placeholder="@brukernavn (daglig oppdatert)"></label>
    <div><button type="button" id="addLink" class="btn">Legg til</button></div>
  </div>

  <hr>

  <!-- Forhåndsvisninger -->
  <div class="preview-wrap">
    <div class="phone">
      <h3>Digitalt kort (live)</h3>
      <iframe id="liveFrame" title="Forhåndsvisning"></iframe>
    </div>
    <div class="mock">
      <div class="inline" style="justify-content:space-between;align-items:center">
        <h3 style="margin:0">Fysisk kort – mockup</h3>
        <div class="inline">
          <label>Stil:
            <select id="cardStyleDemo">
              <option value="dark" selected>Dark</option>
              <option value="light">Light</option>
              <option value="red">Red</option>
            </select>
          </label>
          <button class="pill" id="downloadDemoMock">Last ned (PNG)</button>
        </div>
      </div>
      <!-- Felles renderer (side-by-side) -->
      <canvas id="demoMock" class="card-canvas" width="860" height="540"></canvas>
      <p class="help">Denne mockupen bruker samme renderer og samme data som den øverst – 100% lik visning.</p>
    </div>
  </div>

  <div class="inline" style="margin-top:12px">
    <button class="btn" id="updatePreview">Oppdater forhåndsvisning</button>
    <span class="help">Publisering (GitHub/NFC) gjøres fra adminpanelet.</span>
  </div>

</section>

<footer class="card" style="margin-top:18px">
  <small class="muted">© NFCKING. Laget for fart, trygghet og fleksibilitet. Bygg enkelt videre med Firestore, Netlify og GitHub Pages.</small>
</footer>
<!-- === Opplasting av logo (data-URL) === -->
<script>
  // -- Globalt minne for opplastet logo (data-URL)
  window._uploadedLogoDataUrl = '';

  // Oppdater preview-bildet (bruker opplastet logo hvis den finnes)
  function previewLogo(){
    const img = document.getElementById('logoPreview');
    const bg  = document.getElementById('logoBg').value.trim();
    const src = window._uploadedLogoDataUrl || document.getElementById('logoUrl').value.trim();

    if(!src){ img.style.display='none'; return; }
    img.src = src; img.style.display='block';
    img.style.background = bg || '#ffffff';
    img.style.borderRadius = '8px';
    img.style.padding = '6px';
  }

  // Håndter filopplasting -> lag data-URL og bruk den overalt (mockup + digitalt kort)
  function handleLogoFileInput(file){
    if(!file) return;
    const note = document.getElementById('logoFileNote');
    const reader = new FileReader();
    reader.onload = () => {
      window._uploadedLogoDataUrl = String(reader.result || '');
      // Tøm eventuell URL – den opplastede logoen vinner
      const urlEl = document.getElementById('logoUrl');
      if(urlEl) urlEl.value = '';
      if(note) note.textContent = `Bruker opplastet logo: ${file.name}`;
      previewLogo();
      // Re-render alt
      updatePreview();
    };
    reader.readAsDataURL(file);
  }

  // Koble input-feltet
  document.getElementById('logoFile')?.addEventListener('change', (e)=>{
    const f = e.target.files && e.target.files[0];
    handleLogoFileInput(f);
  });
</script>

<script>
  // === Lenker-tabell ===
  const tbody = document.querySelector('#linksTable tbody');
  function addRow(label, url, pre='', post=''){
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input value="${label||''}" class="lbl" /></td>
      <td><input value="${url||''}" class="lnk" style="width:100%"/></td>
      <td><textarea class="pre" rows="2" placeholder="Tekst over">${pre||''}</textarea></td>
      <td><textarea class="post" rows="2" placeholder="Tekst under">${post||''}</textarea></td>
      <td><button type="button" class="pill remove">Fjern</button></td>`;
    tr.querySelector('.remove').addEventListener('click', ()=>tr.remove());
    tbody.appendChild(tr);
  }
  document.getElementById('addLink').addEventListener('click', ()=>{
    addRow(
      document.getElementById('newLabel').value,
      document.getElementById('newUrl').value,
      document.getElementById('newPre').value,
      document.getElementById('newPost').value
    );
    ['newLabel','newUrl','newPre','newPost'].forEach(id=>document.getElementById(id).value='');
  });
  document.querySelectorAll('.pill[data-label]').forEach(btn=>{
    btn.addEventListener('click', ()=> addRow(btn.dataset.label, btn.dataset.url));
  });

  // === Logo preview med valgfri bakgrunn ===
  function previewLogo(){
    const url = document.getElementById('logoUrl').value.trim();
    const bg  = document.getElementById('logoBg').value.trim();
    const img = document.getElementById('logoPreview');
    if(!url){ img.style.display='none'; return; }
    img.src = url; img.style.display='block';
    img.style.background = bg || '#ffffff';
    img.style.borderRadius = '8px';
    img.style.padding = '6px';
  }

  // Escape helper
  const esc = s => (s||'').replace(/[&<>]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[c]));

  // === Generer HTML for digitalt kort (iframe) ===
  function makeLinksHTML(links){
    if(!links.length) return '';
    return links.map(l => {
      const pre = l.pre ? `<div class="pre" style="margin:8px 0 4px;color:#bfc8d6">${esc(l.pre)}</div>` : '';
      const post= l.post? `<div class="post" style="margin:4px 0 10px;color:#97a3b6;font-size:.95rem">${esc(l.post)}</div>` : '';
      return `<div class="link-block" style="margin-top:10px">
        ${pre}
        <a class="btn" href="${esc(l.url)}" target="_blank" rel="noopener">${esc(l.label)}</a>
        ${post}
      </div>`;
    }).join('');
  }
  function makeHTML(d, links){
    const accent = d.accent || '#8fd3ff';
    const logoTag = d.logoUrl ? `<img class="brand-logo" src="${d.logoUrl}" style="max-height:56px;max-width:280px;object-fit:contain;${d.logoBg?`background:${d.logoBg};border-radius:8px;padding:6px;`:''}" alt="${esc(d.orgName)} logo">` : '';
    const extras = makeLinksHTML(links);
    return `<!doctype html>
<html lang="no">
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Kontaktkort – ${esc(d.name||'')}</title>
<style>
:root{--accent:${accent};}
body{font-family:system-ui,-apple-system,Roboto,Arial;background:#0b0b10;color:#eee;padding:20px}
.container{max-width:760px;margin:0 auto;background:#12121a;padding:24px;border-radius:12px}
.btn{display:inline-block;padding:12px 14px;background:var(--accent);color:#03101a;border-radius:10px;text-decoration:none;font-weight:700}
.links{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap}
.card p{color:#bfc8d6}
.brand-logo{display:block;margin:0 0 12px 0}
</style>
</head>
<body>
<main class="container card">
  ${logoTag}
  <h1>Kontaktkort – ${esc(d.name||'')}</h1>
  <p class="muted">${esc(d.title||'')} · ${esc(d.orgName||'')}</p>
  <div class="links">
    ${d.phone?`<a href="tel:${esc(d.phone)}" class="btn">Ring</a>`:''}
    ${d.email?`<a href="mailto:${esc(d.email)}" class="btn">E-post</a>`:''}
    ${d.site?`<a href="${esc(d.site)}" target="_blank" class="btn">Besøk nettside</a>`:''}
  </div>
  ${extras}
  ${d.address?`<p style="margin-top:14px">Adresse: ${esc(d.address)}</p>`:''}
</main>
</body>
</html>`;
  }

  // === Felles kort-renderer (bruker basebilder: /assets/{dark|light|red}.png) ===
  const BASES = {
    dark:  '/assets/dark.png',
    light: '/assets/light.png',
    red:   '/assets/red.png'
  };

  function loadImg(url){
    return new Promise((resolve,reject)=>{
      const img = new Image();
      img.crossOrigin='anonymous';
      img.onload = ()=>resolve(img);
      img.onerror = reject;
      img.src = url;
    });
  }

  async function renderCardOnCanvas(canvas, d, style='dark'){
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0,0,canvas.width,canvas.height);

    const baseUrl = BASES[style] || BASES.dark;
    const base = await loadImg(baseUrl);

    // Tegn base-mockup (fyll hele canvas)
    const s = Math.max(canvas.width/base.width, canvas.height/base.height);
    const w = base.width*s, h = base.height*s;
    const ox = (canvas.width - w)/2, oy = (canvas.height - h)/2;
    ctx.drawImage(base, ox, oy, w, h);

    // Overlegg: logo i “kortets logo-område”
    // (Velg en trygg boks øverst til høyre – juster gjerne tallene etter dine basebilder.)
    const box = { x: canvas.width*0.62, y: canvas.height*0.18, w: canvas.width*0.24, h: canvas.height*0.24 };
    if (d.logoUrl){
      try{
        const logo = await loadImg(d.logoUrl);
        // valgfri hvit bakgrunnsplate
        if ((d.logoBg||'').trim()){
          ctx.fillStyle = d.logoBg.trim();
          const r = 12; // litt avrunding
          roundRect(ctx, box.x, box.y, box.w, box.h, r); ctx.fill();
        }
        // bevar aspektforhold
        const sc = Math.min(box.w / logo.width, box.h / logo.height);
        const lw = logo.width*sc, lh = logo.height*sc;
        const lx = box.x + (box.w-lw)/2, ly = box.y + (box.h-lh)/2;
        ctx.drawImage(logo, lx, ly, lw, lh);
      }catch(e){/* ignorer logo feil */ }
    }

    // Tekstlayout (venstreside)
    ctx.fillStyle = '#eaf2ff'; ctx.font = '800 40px system-ui, -apple-system, Segoe UI, Roboto, Arial';
    drawText(ctx, d.name || 'Navn Navnesen', canvas.width*0.06, canvas.height*0.36);

    ctx.fillStyle = '#9fb0c6'; ctx.font = '600 26px system-ui, -apple-system, Segoe UI, Roboto, Arial';
    drawText(ctx, d.title || '', canvas.width*0.06, canvas.height*0.42);

    // Kontaktlinjer
    ctx.fillStyle = '#eaf2ff'; ctx.font = '600 22px system-ui, -apple-system, Segoe UI, Roboto, Arial';
    let y = canvas.height*0.50;
    const lines = [];
    if(d.phone) lines.push(['Tel', d.phone]);
    if(d.email) lines.push(['E-post', d.email]);
    if(d.site)  lines.push(['Nettside', d.site]);

    lines.forEach(([label,val])=>{
      ctx.fillStyle = '#a9b8cf'; ctx.font = '700 22px system-ui, -apple-system, Segoe UI, Roboto, Arial';
      ctx.fillText(label+':', canvas.width*0.06, y);
      ctx.fillStyle = '#eaf2ff'; ctx.font = '600 22px system-ui, -apple-system, Segoe UI, Roboto, Arial';
      ctx.fillText(String(val), canvas.width*0.18, y);
      y += 34;
    });

    // Hint nederst
    ctx.fillStyle = 'rgba(159,176,198,.95)'; ctx.font = '600 20px system-ui, -apple-system, Segoe UI, Roboto, Arial';
    drawText(ctx, 'Scan NFC / QR for digitalt kort', canvas.width*0.06, canvas.height*0.92);
  }

  function roundRect(ctx, x, y, w, h, r){
    const rr = Math.min(r, w/2, h/2);
    ctx.beginPath();
    ctx.moveTo(x+rr, y);
    ctx.lineTo(x+w-rr, y);
    ctx.quadraticCurveTo(x+w, y, x+w, y+rr);
    ctx.lineTo(x+w, y+h-rr);
    ctx.quadraticCurveTo(x+w, y+h, x+w-rr, y+h);
    ctx.lineTo(x+rr, y+h);
    ctx.quadraticCurveTo(x, y+h, x, y+h-rr);
    ctx.lineTo(x, y+rr);
    ctx.quadraticCurveTo(x, y, x+rr, y);
    ctx.closePath();
  }

  function drawText(ctx, text, x, y){
    ctx.save();
    ctx.textBaseline = 'alphabetic';
    ctx.fillText(text, x, y);
    ctx.restore();
  }

  // === Oppdater begge mockups + iframe ===
  async function updatePreview(){
    const d = {
      orgName: document.getElementById('orgName').value.trim() || document.getElementById('orgKey').value.trim(),
      orgKey:  document.getElementById('orgKey').value.trim(),
      accent:  document.getElementById('accent').value.trim() || '#8fd3ff',
      logoUrl: window._uploadedLogoDataUrl || document.getElementById('logoUrl').value.trim(),
      logoBg:  document.getElementById('logoBg').value.trim(),
      name:    document.getElementById('name').value.trim(),
      title:   document.getElementById('title').value.trim(),
      phone:   document.getElementById('phone').value.trim(),
      email:   document.getElementById('email').value.trim(),
      site:    document.getElementById('site').value.trim(),
      address: document.getElementById('address').value.trim(),
      slug:    document.getElementById('slug').value.trim(),
      vcfFilename: document.getElementById('vcfFilename').value.trim()
    };

    const links = Array.from(document.querySelectorAll('#linksTable tbody tr')).map(tr=>({
      label: tr.querySelector('.lbl').value.trim(),
      url:   tr.querySelector('.lnk').value.trim(),
      pre:   tr.querySelector('.pre').value.trim(),
      post:  tr.querySelector('.post').value.trim()
    })).filter(x=>x.label && x.url);

    // iFrame (digitalt kort)
    const html = makeHTML(d, links);
    const frame = document.getElementById('liveFrame');
    const doc = frame.contentDocument || frame.contentWindow.document;
    doc.open(); doc.write(html); doc.close();

    // Mockups (samme renderer og samme stilvalg)
    const styleTop  = document.getElementById('cardStyle').value;
    const styleDemo = document.getElementById('cardStyleDemo').value;
    await renderCardOnCanvas(document.getElementById('heroMock'), d, styleTop);
    await renderCardOnCanvas(document.getElementById('demoMock'), d, styleDemo);
  }

  // UI hooks
  document.getElementById('updatePreview').addEventListener('click', updatePreview);
  ['orgName','orgKey','accent','logoUrl','logoBg','name','title','phone','email','site','address','slug','vcfFilename']
    .forEach(id => document.getElementById(id).addEventListener('input', e=>{
      if(id==='logoUrl' || id==='logoBg') previewLogo();
      updatePreview();
    }));

  // Stilvelgere synker ikke automatisk – vi lar brukeren styre hver for seg
  document.getElementById('cardStyle').addEventListener('change', updatePreview);
  document.getElementById('cardStyleDemo').addEventListener('change', updatePreview);

  // Last ned-knapper
  document.getElementById('downloadHeroMock').addEventListener('click', ()=>{
    const c = document.getElementById('heroMock');
    const a = document.createElement('a'); a.href = c.toDataURL('image/png'); a.download='kort-mockup-hero.png'; a.click();
  });
  document.getElementById('downloadDemoMock').addEventListener('click', ()=>{
    const c = document.getElementById('demoMock');
    const a = document.createElement('a'); a.href = c.toDataURL('image/png'); a.download='kort-mockup-demo.png'; a.click();
  });

  // Start med en eksempel-lenke og første render
  addRow('LinkedIn','https://www.linkedin.com/in/','Følg meg','Oppdateres jevnlig');
  updatePreview();
</script>

</body>
</html>
